<!DOCTYPE html>
<html xmlns:svg="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink">
<head>
<meta charset="UTF-8"/>
<script type="text/ecmascript">
//<![CDATA[
var Circle, X, Y, XP, YP, oT, oL, B;
window.onload = function() {
  var Colors = {"red":"赤", "yellow":"黄色","green":"緑", 
                     "blue":"青","gray":"灰色","black":"黒"};
  var tmp, tmpText, Color;
  var SelectColor = document.getElementById("SelectColor");
  for( Color in Colors) {
    tmp = document.createElement("option");
    tmp.setAttribute("value", Color);
    tmpText = document.createTextNode(Colors[Color]);
    tmp.appendChild(tmpText);
    SelectColor.appendChild(tmp);
  }
  XP = document.getElementById("XP");
  YP = document.getElementById("YP");
  Circle = document.getElementById("Circle");
  X = document.getElementById("X");
  Y = document.getElementById("Y");
  XP.value = Circle.getAttribute("cx");
  YP.value = Circle.getAttribute("cy");
  document.getElementById("field").addEventListener("click",click, false);
  document.getElementById("SetColor").onclick = refresh;

  B = document.getElementById("canvas").getBoundingClientRect();
  oL = Math.floor(B.left)+5;
  oT = Math.floor(B.top)+5; 
  refresh();
}
function click(event) {
  XP.value = event.clientX-oL;
  YP.value = event.clientY-oT;
  refresh();
}
function refresh() {
  SetText(X,"cx", XP.value);
  SetText(Y,"cy", YP.value);
  Circle.setAttribute("fill", SelectColor.value);
}

function SetText(Element, attrib, Value) {
  var txtNode = document.createTextNode(Value);
  if( Element.firstChild) {
     Element.replaceChild(txtNode, Element.firstChild);
  } else {
     Element.appendChild(txtNode);
  }
  Circle.setAttribute(attrib, Value);
}
//]]>  
</script>
<link rel="stylesheet" type="text/css" href="HTML.css">
<title>HTMLとSVGの間でデータを交換させる</title>
</head>
<body>
  <h1 class="display">クリック位置をHTML内に表示、HTMLから移動させる</h1>
  <div class="Cell">
    <svg height="410" width="410" id="canvas">
      <g transform="translate(5,5)">
        <g id="field">
          <rect x="0" y="0" width="400" height="400" fill="lightgray"/>
          <circle id="Circle" cx="200" cy="50" r="20" fill="red"/>
          <text class="textStyle" x="50" y="50"> X</text>
          <text class="textStyle" id="X" x="150" y="50"></text>
          <text class="textStyle" x="50" y="100"> Y</text>
          <text class="textStyle" id="Y" x="150" y="100"></text>
        </g>
        <path fill="blue"
          d="M-5,-5 405,-5 405,405 -5,405z M0,0 0,400 400,400 400,0z" />
      </g>
    </svg>
  </div>
  <div class="Cell" >
    <div><label for="XP">x=</label>
      <input type="text" id="XP" size="3" /></div>
    <div><label for="YP">y=</label>
      <input type="text" id="YP" size="3" /></div>
    <div><label for="SelectColor">色</label>
      <select id="SelectColor"></select></div>
    <input id="SetColor" type="button" value="設定"></input>
  </div>
</body>
</html>
